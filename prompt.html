<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Prompt Generator Dashboard</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      height: 100vh;
    }

    .sidebar {
      width: 250px;
      background: #f5f5f5;
      border-right: 1px solid #ccc;
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
    }

    .main {
      flex: 1;
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
    }

    h2 {
      margin-top: 0;
    }

    textarea, input, select {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      box-sizing: border-box;
      font-size: 14px;
    }

    button {
      padding: 8px 16px;
      margin-top: 10px;
      cursor: pointer;
    }

    #result {
      margin-top: 20px;
      background: #eef;
      padding: 10px;
      white-space: pre-wrap;
      border-left: 4px solid #007bff;
    }

    .template-btn {
      background: none;
      border: none;
      padding: 8px 0;
      cursor: pointer;
      display: block;
      width: 100%;
      text-align: left;
    }

    .template-btn:hover {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <h3>üß© Templates</h3>
    <div id="templateList"></div>
    <button onclick="createTemplate()">‚ûï New Template</button>
  </div>

  <div class="main">
    <h2>‚öôÔ∏è Prompt Generator</h2>

    <label><strong>Prompt Template</strong> (use {{variable}} syntax):</label>
    <textarea id="promptTemplate" rows="5"></textarea>

    <div id="dynamicFields"></div>

    <h3>‚öôÔ∏è Actions</h3>
    <div id="actionsContainer"></div>
    <button onclick="addAction()">‚ûï Add Action</button>

    <button onclick="generate()">‚úÖ Generate Prompt</button>

    <div id="result"></div>
  </div>

  <script>
    let templates = {
      "Root Cause Analysis": {
        template: "Analyze anomaly in {{main_metric}} caused by {{breakdown_column}} in {{region}}. Focus on {{action_combination}}.",
        fields: ["main_metric", "breakdown_column", "region"]
      },
      "Performance Summary": {
        template: "Summarize performance of {{campaign}} over {{time_period}}. Highlight changes in {{kpi}}.",
        fields: ["campaign", "time_period", "kpi"]
      }
    };

    let actions = {
      "Compare Uplift": "Compare uplift of {{main_metric}} between test and control.",
      "Segment Breakdown": "Break down performance by {{segment_column}}.",
      "Fraud Detection": "Look into potential fraud using {{fraud_metric}}."
    };

    function renderTemplateList() {
      const list = document.getElementById("templateList");
      list.innerHTML = '';
      Object.keys(templates).forEach(name => {
        const btn = document.createElement("button");
        btn.className = "template-btn";
        btn.innerText = name;
        btn.onclick = () => loadTemplate(name);
        list.appendChild(btn);
      });
    }

    function loadTemplate(name) {
      const data = templates[name];
      document.getElementById("promptTemplate").value = data.template;
      updateFields(data.fields);
    }

    function updateFields(fields) {
      const container = document.getElementById("dynamicFields");
      container.innerHTML = '';
      fields.forEach(f => {
        const label = document.createElement("label");
        label.innerText = `${f}:`;
        const input = document.createElement("input");
        input.id = f;
        input.placeholder = `Enter ${f}`;
        container.appendChild(label);
        container.appendChild(input);
      });
    }

    function addAction() {
      const select = document.createElement("select");
      Object.keys(actions).forEach(key => {
        const option = document.createElement("option");
        option.value = key;
        option.innerText = key;
        select.appendChild(option);
      });
      document.getElementById("actionsContainer").appendChild(select);
    }

    function generate() {
      let template = document.getElementById("promptTemplate").value;
      const fields = document.querySelectorAll('#dynamicFields input');
      let values = {};
      fields.forEach(f => values[f.id] = f.value);

      const actionSelects = document.querySelectorAll('#actionsContainer select');
      let actionSnippets = [];
      actionSelects.forEach(s => {
        const actionText = actions[s.value];
        actionSnippets.push(replaceKeywords(actionText, values));
      });
      values['action_combination'] = actionSnippets.join(' ');

      const result = replaceKeywords(template, values);
      document.getElementById("result").innerText = result;
    }

    function replaceKeywords(template, vars) {
      for (const key in vars) {
        const regex = new RegExp(`{{${key}}}`, 'g');
        template = template.replace(regex, vars[key]);
      }
      return template;
    }

    function createTemplate() {
      const name = prompt("Enter new template name:");
      if (!name) return;
      templates[name] = {
        template: "Enter your prompt here with {{variables}}.",
        fields: []
      };
      renderTemplateList();
      loadTemplate(name);
    }

    // Load default
    window.onload = () => {
      renderTemplateList();
      loadTemplate("Root Cause Analysis");
    };
  </script>
</body>
</html>
